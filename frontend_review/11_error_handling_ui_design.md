# 🚀 11. Error Handling UI/UX Design

안정적이고 사용자 친화적인 웹 애플리케이션을 위해, RAG 기반 특허 분석 중 발생할 수 있는 주요 예외 상황(Error)에 대한 UI/UX를 설계합니다.

---

## 🎯 1. 에러 시나리오별 메시지 맵 (Message Map)

분석 중 다음과 같은 예외 상황이 발생했을 때, 브라우저 기본 `alert()` 대신 부드러운 토스트(Toast) 또는 전역 에러 화면(Fallback UI)으로 전환하여 표시할 텍스트입니다.

| 상황 | 에러 코드 (예시) | 사용자 노출 아이콘 및 메시지 |
| :--- | :--- | :--- |
| **🔌 네트워크 오류** | 502 / 503 / Network Error | "일시적인 연결 문제가 발생했습니다. 잠시 후 다시 시도해 주세요." |
| **⏱️ 타임아웃** | 504 Gateway Timeout | "분석에 시간이 초과되었습니다. 입력을 줄여서 다시 시도해 주세요." |
| **🚫 토큰 (글자수) 초과** | 413 / 422 Unprocessable Entity | "입력 텍스트가 너무 깁니다. 핵심 아이디어만 간결하게 입력해 주세요." |
| **📭 검색 결과 없음** | 404 / 200 (Empty List) | "유사한 특허를 찾지 못했습니다. 다른 키워드 또는 더 포괄적인 단어로 시도해 보세요." |

---

## 🔄 2. 복구 경로 (Recovery Path) 설계

사용자 경험(UX) 관점에서 에러는 "막다른 길"이 되어서는 안 됩니다. 
에러 발생 시 **"다시 시도"** 또는 **"수정 후 다시 분석"** 할 수 있는 Action Button을 에러 모달 하단에 배치합니다.

1. **상태 초기화 로직 연동 (`useRagStream.ts`)**: 
   - 에러 발생 시 `cancelAnalysis()`(내부 `AbortController` 활용)를 호출하여 먹통이 된 백그라운드 스트림을 즉시 차단합니다.
   - 상태(`isAnalyzing`, `isComplete`)를 초기화하여 다시 초기 폼(Form) 화면으로 돌아갈 수 있도록 복구 트리를 트리거합니다.
2. **다시 시도 버튼 렌더링**:
   - 에러가 캐치된 경우, 화면 전체를 덮는 Fallback 래퍼(Wrapper)를 띄우고 `<button onClick={handleReset}>다시 시도하기 🔄</button>` 을 제공합니다.

---

## ✨ 3. "검색 결과 없음" 시 키워드 추천 로직

결과가 비어 있을 때 단순히 에러를 띄우기보다는 대안을 제시하는 것이 RAG 시스템의 핵심 가치입니다.

- **기능 검토 1 (프론트엔드 단독 처리 - 로컬 추천)**: 
  - 과거 사용자가 입력했던 다른 카테고리의 템플릿(예: "IoT 기술", "소프트웨어")을 제안하는 버튼 액션을 띄웁니다.
- **기능 검토 2 (백엔드 협력 처리 - LLM 추천)**: 
  - 백엔드에 아예 `event: suggestion` 이라는 별도 파싱 블록을 만들어, LLM이 **"이런 검색어는 어떨까요?"** 라고 뱉어준 텍스트를 노출시킵니다. (백엔드 에이전트와 협의 필요)

---

## 🖼️ 4. 에러 화면 와이어프레임 (Wireframe)

```text
+-------------------------------------------------------------+
|                                                             |
|           💡 쇼특허 (Short-Cut) AI                          |
|                                                             |
+-------------------------------------------------------------+
|                                                             |
|    [!] 에러 발생: 분석을 완료하지 못했습니다.               |
|                                                             |
|    ╭───────────────────────────────────────────────────╮    |
|    │ 🚫 상태: 입력 텍스트가 너무 깁니다.               │    |
|    │ 💡 조치사항: 핵심 아이디어만 간결하게             │    |
|    │              다시 입력해 주세요. (500자 이내)     │    |
|    ╰───────────────────────────────────────────────────╯    |
|                                                             |
|           [ 다시 아이디어 입력하기 🔄 ]                     |
|                                                             |
+-------------------------------------------------------------+
```

---

### 📋 PM 및 Backend 전달용 백로그

- **Epic: 안정성 및 에러 처리 고도화 (Frontend)**
  - [ ] 전역 에러 바운더리(Error Boundary) 및 공통 `ErrorFallback` UI 컴포넌트 추가
  - [ ] `useRagStream` 내 에러 캐치 로직 세분화 (네트워크오류, 타임아웃 등 분기 처리)
- **Epic: 백엔드 협업 요청 (Backend에게 전달할 사항 - 🚨중요🚨)**
  - [ ] **HTTP 상태 코드 파편화 방지**: 500, 502, 504, 422 상황에 대해 FastAPI 단에서 확실한 표준 에러 응답 객체(e.g., `{"detail": "..."}`)를 정의해 줄 것.
  - [ ] 검색 결과(Vector DB 반환값)가 0건일 때, 프론트엔드가 이를 인식할 수 있도록 `event: empty` 상태 구조를 명시할 것.
