# 17. Rate Limit 안내 UI & 검색 히스토리 사이드바 설계

Rate Limit 초과(429) 발생 시 사용자 친화적 안내를 제공하고, 세션 기반 과거 분석 내역을 사이드바로 노출하여 재분석·재확인이 가능한 UI를 설계합니다.

---

## 🎯 1. 429 Too Many Requests 안내 모달

### 🔴 트리거 조건
`useRagStream.ts`의 `fetch` 응답 중 `response.status === 429` 발생 시

### UI 동작
1. 분석 요청 중단 (AbortController 해제)
2. 전역 `RateLimitModal` 컴포넌트 표시 (오버레이 형태)
3. 남은 재시도 가능 시간 카운트다운 (서버 응답 헤더 `Retry-After` 활용 예정)

### 에러 메시지 시나리오
| 제한 사유 | 표시 메시지 |
|---|---|
| 일일 한도 초과 (10회) | "오늘의 분석 횟수(10회)를 모두 사용했습니다. 내일 다시 시도해 주세요." |
| 시간당 한도 초과 | "1시간 내 많은 요청이 감지되었습니다. {N}분 후 다시 시도해 주세요." |
| IP 기반 제한 | "현재 이 네트워크에서 많은 요청이 발생했습니다. 잠시 후 다시 시도해 주세요." |

### UI 구성 요소
```
┌─────────────────────────────────────┐
│  🚦 분석 한도에 도달했습니다           │
│                                     │
│  오늘의 분석 횟수(10회)를 모두         │
│  사용하셨습니다.                       │
│                                     │
│  ⏰ 다음 분석까지: 14시간 32분         │
│                                     │
│  [ 검색 히스토리 보기 ]  [ 확인 ]     │
└─────────────────────────────────────┘
```

---

## 🎯 2. 검색 히스토리 사이드바 UI

### 구조 및 동작
- 화면 우측에 슬라이드인/슬라이드아웃 패널 (`transform: translateX`)
- 헤더 우측 "📋 히스토리" 버튼으로 토글
- 세션 ID 기반으로 Backend `GET /api/history?session_id={id}` 호출

### 히스토리 아이템 카드
```
┌─────────────────────────────────────┐
│ 🔴 High Risk           2월 27일 15:32│
│ "스마트 안경에 AR 내비게이션을..."      │
│ 유사 특허 4건 발견                    │
│                          [결과 보기] │
└─────────────────────────────────────┘
```

| 항목 | 내용 |
|---|---|
| 위험도 뱃지 | High🔴 / Medium🟡 / Low🟢 |
| 아이디어 요약 | 최대 50자 truncate |
| 분석 일시 | 날짜·시간 |
| 결과 보기 버튼 | InlineResult 상태로 전환 (재요청 없이 캐시 데이터 표시) |
| 재분석 버튼 | `startAnalysis(idea)` 재호출 |

### 빈 상태 (Empty Placeholder) UI
```
┌─────────────────────────────────────┐
│           📭                        │
│   아직 분석 기록이 없습니다.            │
│   첫 번째 특허 검증을 시작해 보세요!     │
│                                     │
│         [ 아이디어 입력하기 ]          │
└─────────────────────────────────────┘
```

---

## 🗂️ 3. 신규 파일 구조

```
frontend/src/
├── components/
│   ├── common/
│   │   └── RateLimitModal.tsx     ← [NEW] 429 안내 모달
│   └── History/
│       ├── HistorySidebar.tsx      ← [NEW] 사이드바 컨테이너
│       ├── HistoryItem.tsx         ← [NEW] 히스토리 아이템 카드
│       └── HistoryEmpty.tsx        ← [NEW] 빈 상태 플레이스홀더
├── hooks/
│   └── useHistory.ts               ← [NEW] 히스토리 데이터 페치 훅
└── types/
    └── rag.ts                      ← [MODIFY] HistoryRecord 타입 추가
```

---

## 📋 Backend에게 전달할 협업 요청 사항

- **GET `/api/history`**: 쿼리 파라미터 `session_id`로 해당 세션의 분석 내역 배열 반환 요청
  - 응답 필드 예시: `[{ id, idea, riskLevel, riskScore, similarCount, createdAt }]`
- **429 응답 헤더**: `Retry-After` 헤더(초 단위)를 포함시켜 주시면 프론트에서 카운트다운 타이머 구현 가능합니다.
- **제한 유형 필드**: `429` 응답 바디에 `{ reason: 'daily_limit' | 'hourly_limit' | 'ip_limit', retryAfter: number }` 포함 요청
